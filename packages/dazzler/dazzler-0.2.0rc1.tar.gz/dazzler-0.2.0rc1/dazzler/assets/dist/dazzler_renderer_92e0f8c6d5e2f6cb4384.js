!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):"object"==typeof exports?exports.dazzler_renderer=t(require("react"),require("react-dom")):e.dazzler_renderer=t(e.React,e.ReactDOM)}(window,function(e,t){return function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],f=0,l=[];f<s.length;f++)a=s[f],o[a]&&l.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(p&&p(t);l.length;)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={6:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonpdazzler_name_=window.webpackJsonpdazzler_name_||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var p=c;return i.push([415,0]),n()}({1:function(t,n){t.exports=e},222:function(e,n){e.exports=t},415:function(e,t,n){e.exports=n(616)},616:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(222),a=n.n(i),s=n(0),c=n.n(s);function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){p(e,t,n[t])})}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=/json/i,l={method:"GET",headers:{},payload:"",json:!0},d={"Content-Type":"application/json"};function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(){var t=e+arguments[0],n=arguments[1]||{};return n.headers=u({},n.headers),new Promise(function(e){(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;return new Promise(function(n,r){var o=u({},l,t),i=o.method,a=o.headers,s=o.payload,c=o.json,p=new XMLHttpRequest;p.open(i,e);var y=c?u({},d,a):a;Object.keys(y).forEach(function(e){return p.setRequestHeader(e,y[e])}),p.onreadystatechange=function(){if(p.readyState===XMLHttpRequest.DONE)if(p.status<400){var t=p.response;f.test(p.getResponseHeader("Content-Type"))&&(t=JSON.parse(p.responseText)),n(t)}else r({error:"RequestError",message:"XHR ".concat(e," FAILED - STATUS: ").concat(p.status," MESSAGE: ").concat(p.statusText),status:p.status,xhr:p})},p.onerror=function(e){return r(e)},p.send(c?JSON.stringify(s):s)})})(t,n).then(e)})}}var b=n(145),h=n(225),m=n(624),g=n(622),v=n(623),O=n(10);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){k(e,t,n[t])})}return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=!(o=_(t).call(this,e))||"object"!==w(o)&&"function"!=typeof o?P(r):o).state={aspects:e.aspects||{},ready:!1,initial:!1},n.setAspects=n.setAspects.bind(P(n)),n.getAspect=n.getAspect.bind(P(n)),n.updateAspects=n.updateAspects.bind(P(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,o.a.Component),n=t,(r=[{key:"updateAspects",value:function(e){var t=this;return this.setAspects(e).then(function(){return t.props.updateAspects(t.props.identity,e)})}},{key:"setAspects",value:function(e){var t=this;return new Promise(function(n){t.setState({aspects:j({},t.state.aspects,e)},n)})}},{key:"getAspect",value:function(e){return this.state.aspects[e]}},{key:"componentDidMount",value:function(){var e=this;this.props.connect(this.props.identity,this.setAspects,this.getAspect),this.state.initial||this.updateAspects(this.state.aspects).then(function(){return e.setState({ready:!0,initial:!0})})}},{key:"componentWillUnmount",value:function(){this.props.disconnect(this.props.identity)}},{key:"render",value:function(){var e=this.props,t=e.component,n=e.component_name,r=e.package_name,i=this.state,a=i.aspects;return i.ready?o.a.cloneElement(t,j({},a,{updateAspects:this.updateAspects,identity:this.props.identity,class_name:Object(g.a)(" ",Object(v.a)(["".concat(r.replace("_","-").toLowerCase(),"-").concat(Object(O.camelToSpinal)(n))],a.class_name?a.class_name.split(" "):[]))})):null}}])&&S(n.prototype,r),i&&S(n,i),t}();function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function T(e){return"Object"===Object(b.a)(e)&&e.hasOwnProperty("package")&&e.hasOwnProperty("aspects")&&e.hasOwnProperty("name")&&e.hasOwnProperty("identity")}function x(e,t,n,r){var o={};return Object.entries(e).forEach(function(e){var i=q(e,2),a=i[0],s=i[1];if("Array"===Object(b.a)(s))o[a]=s.map(function(e){if(!T(e))return e;var o=x(e.aspects,t,n,r);return o.key||(o.key=e.identity),z(e.name,e.package,e.identity,o,t,n,r)});else if(T(s)){var c=x(s.aspects,t,n,r);o[a]=z(s.name,s.package,s.identity,c,t,n,r)}else"Object"===Object(b.a)(s)&&(o[a]=x(s,t,n,r))}),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){R(e,t,n[t])})}return e}({},e,o)}function z(e,t,n,r,i,a,s){var c=window[t],u=o.a.createElement(c[e],r);return o.a.createElement(E,{identity:n,updateAspects:i,component:u,connect:a,package_name:t,component_name:e,aspects:r,disconnect:s,key:"wrapper-".concat(n)})}function C(e){return o.a.isValidElement(e)?{identity:e.props.identity,aspects:Object(h.a)(C,Object(m.a)(["identity","updateAspects","_name","_package","aspects","key"],e.props.aspects)),name:e.props.component_name,package:e.props.package_name}:"Array"===Object(b.a)(e)?e.map(C):"Object"===Object(b.a)(e)?Object(h.a)(C,e):e}function M(e){return new Promise(function(t,n){var r,o=e.url,i=e.kind,a=e.meta;if("js"===i)r=O.loadScript;else{if("css"!==i)return"map"===i?t():n({error:"Invalid requirement kind: ".concat(i)});r=O.loadCss}return r(o,a).then(t).catch(n)})}E.propTypes={identity:c.a.string.isRequired,updateAspects:c.a.func.isRequired,component:c.a.node.isRequired,connect:c.a.func.isRequired,component_name:c.a.string.isRequired,package_name:c.a.string.isRequired,disconnect:c.a.func.isRequired};var N=n(34);function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){D(e,t,n[t])})}return e}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var K=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=!(o=W(t).call(this,e))||"object"!==J(o)&&"function"!=typeof o?H(r):o).state={layout:!1,ready:!1,page:null,bindings:{},packages:[],requirements:[],reloading:!1,needRefresh:!1},n.pageApi=y(window.location.href),n.boundComponents={},n.ws=null,n.updateAspects=n.updateAspects.bind(H(n)),n.connect=n.connect.bind(H(n)),n.disconnect=n.disconnect.bind(H(n)),n.onMessage=n.onMessage.bind(H(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,o.a.Component),n=t,(r=[{key:"updateAspects",value:function(e,t){var n=this;return new Promise(function(r){var o=Object.keys(t).map(function(t){return n.state.bindings["".concat(e,".").concat(t)]}).filter(function(e){return e});if(!o)return r(0);o.forEach(function(e){return n.sendBinding(e,t[e.trigger.aspect])}),r()})}},{key:"connect",value:function(e,t,n){this.boundComponents[e]={setAspects:t,getAspect:n}}},{key:"disconnect",value:function(e){delete this.boundComponents[e]}},{key:"onMessage",value:function(e){var t,n=this,r=JSON.parse(e.data),o=r.identity,i=r.kind,a=r.payload,s=r.storage,c=r.request_id;switch(t="session"===s?window.sessionStorage:window.localStorage,i){case"set-aspect":var u=this.boundComponents[o];if(!u){var p="Component not found: ".concat(o);return this.ws.send(JSON.stringify({error:p,kind:"error"})),void console.error(p)}u.setAspects(x(a,this.updateAspects,this.connect,this.disconnect)).then(function(){Object.keys(a).forEach(function(e){var t="".concat(o,".").concat(e),r=n.state.bindings[t];r&&n.sendBinding(r,u.getAspect(e))})});break;case"get-aspect":var f=r.aspect,l=this.boundComponents[o];if(!l)return void this.ws.send(JSON.stringify({kind:i,identity:o,aspect:f,request_id:c,error:"Aspect not found ".concat(o,".").concat(f)}));var d=l.getAspect(f);this.ws.send(JSON.stringify({kind:i,identity:o,aspect:f,value:C(d),request_id:c}));break;case"set-storage":t.setItem(o,JSON.stringify(a));break;case"get-storage":this.ws.send(JSON.stringify({kind:i,identity:o,request_id:c,value:JSON.parse(t.getItem(o))}));break;case"reload":var y=r.filenames,b=r.hot,h=r.refresh,m=r.deleted;if(h)return this.ws.close(),this.setState({reloading:!0,needRefresh:!0});if(b)return this.setState({reloading:!0});y.forEach(M),m.forEach(function(e){return Object(N.d)(e.url)})}}},{key:"sendBinding",value:function(e,t){var n=this,r={trigger:U({},e.trigger,{value:C(t)}),states:e.states.map(function(e){return U({},e,{value:n.boundComponents[e.identity]&&C(n.boundComponents[e.identity].getAspect(e.aspect))})}),kind:"binding",page:this.state.page,key:e.key};this.ws.send(JSON.stringify(r))}},{key:"_connectWS",value:function(){var e=this,t=0,n=!1;!function r(){e.ws=new WebSocket("ws".concat(window.location.href.startsWith("https")?"s":"","://").concat(e.props.baseUrl&&e.props.baseUrl||window.location.host).concat(window.location.pathname,"/ws")),e.ws.addEventListener("message",e.onMessage),e.ws.onopen=function(){e.state.reloading?(n=!0,e.ws.close(),e.state.needRefresh?window.location.reload():e.props.hotReload()):(e.setState({ready:!0}),t=0)},e.ws.onclose=function(){!n&&t<e.props.retries&&setTimeout(function(){t++,r()},1e3)}}()}},{key:"componentWillMount",value:function(){var e=this;this.pageApi("",{method:"POST"}).then(function(t){var n,r;e.setState({page:t.page,layout:t.layout,bindings:t.bindings,packages:t.packages,requirements:t.requirements}),(n=t.requirements,r=t.packages,new Promise(function(e,t){var o=[];Object.keys(r).forEach(function(e){var t=r[e];o=o.concat(t.requirements.map(M))}),Promise.all(o).then(function(){var t=0;!function r(){t<n.length?M(n[t]).then(function(){t++,r()}):e()}()}).catch(t)})).then(function(){Object.keys(t.bindings).length||t.reload?e._connectWS():e.setState({ready:!0})})})}},{key:"render",value:function(){var e=this.state,t=e.layout,n=e.ready,r=e.reloading;if(!n)return o.a.createElement("div",{className:"dazzler-loading"},"Loading...");if(r)return o.a.createElement("div",{className:"dazzler-loading"},"Reloading...");if(!T(t))throw new Error("Layout is not a component: ".concat(t));return o.a.createElement("div",{className:"dazzler-rendered"},z(t.name,t.package,t.identity,x(t.aspects,this.updateAspects,this.connect,this.disconnect),this.updateAspects,this.connect,this.disconnect))}}])&&L(n.prototype,r),i&&L(n,i),t}();function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(){return(X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}K.defaultProps={},K.propTypes={baseUrl:c.a.string.isRequired,ping:c.a.bool,ping_interval:c.a.number,retries:c.a.number,hotReload:c.a.func};var Y=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=F(this,V(t).call(this,e))).state={reloadKey:1},n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,o.a.Component),n=t,(r=[{key:"componentWillMount",value:function(){window.dazzler_base_url=this.props.baseUrl}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"dazzler-renderer"},o.a.createElement(K,X({},this.props,{key:"upd-".concat(this.state.reloadKey),hotReload:function(){return e.setState({reloadKey:e.state.reloadKey+1})}})))}}])&&G(n.prototype,r),i&&G(n,i),t}();function Z(e,t){var n=e.baseUrl,r=e.ping,i=e.ping_interval,s=e.retries;a.a.render(o.a.createElement(Y,{baseUrl:n,ping:r,ping_interval:i,retries:s}),t)}Y.propTypes={baseUrl:c.a.string.isRequired,ping:c.a.bool,ping_interval:c.a.number,retries:c.a.number},n.d(t,"render",function(){return Z}),n.d(t,"Renderer",function(){return Y})}})});
//# sourceMappingURL=dazzler_renderer_92e0f8c6d5e2f6cb4384.js.map